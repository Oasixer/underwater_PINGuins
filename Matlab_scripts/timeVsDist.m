peak_times = [
[205374; 205361; 205343; 205294; 205270; 205326; 205336; 205276; 205295; 205314;
205350; 205288; 205312; 205313; 205285; 205323; 205284; 205303; 205287; 205304;
205313; 205275; 205317; 205238; 205270; 205272; 205301; 205283; 205282; 205262;
205247; 205306; 205326; 205299; 205300; 205322; 205301; 205282; 205299; 205272;
205308; 205304; 205264; 205269; 205270; 205286; 205284; 205239; 205327; 205256;
205261; 205262; 205307; 205269; 205260; 205292; 205251; 205282; 205272; 205309;
205308; 205266; 205265; 205253; 205259; 205308; 205269; 205269; 205256; 205245;
205321; 205289; 205291; 205263; 205321; 205287; 205279; 205274; 205272; 205301;
205309; 205238; 205300; 205250; 205286; 205268; 205325; 205307; 205270; 205235;
204996; 205270; 205307; 205238; 205286; 205274; 205295; 205324; 205223; 205280;
]';%2m
[207925; 207949; 207942; 207973; 208014; 207960; 207642; 207948; 207938; 207940;
207913; 207964; 207934; 207949; 207937; 207935; 207978; 207904; 207947; 207961;
207938; 207935; 207950; 207994; 207945; 207962; 207913; 207908; 207908; 207932;
207935; 207941; 207941; 207939; 207966; 207910; 207978; 207959; 207936; 207962;
207990; 208040; 207962; 207988; 207925; 207939; 207954; 207949; 207963; 207932;
207931; 207959; 207934; 207939; 207933; 207969; 207926; 207932; 207952; 207932;
207930; 208017; 207968; 207958; 207974; 207916; 207956; 207951; 207998; 207928;
207982; 207969; 207911; 207929; 207950; 207965; 207956; 207950; 207972; 207924;
207906; 207930; 207943; 207924; 207953; 207958; 207936; 207968; 207947; 207965;
207947; 207937; 207959; 207968; 207972; 207913; 207750; 207946; 207642; 207923;
]'; %4m
[207098; 207116; 207108; 207140; 207142; 207116; 207092; 207106; 207140; 207078;
207132; 207108; 207114; 207092; 207121; 207110; 207120; 207105; 207116; 207150;
207094; 207119; 207087; 207131; 207074; 207120; 207076; 207120; 207106; 207091;
207092; 207113; 207091; 207127; 207088; 207114; 207084; 207142; 207096; 207104;
207081; 207096; 207114; 207089; 207125; 207089; 207089; 207115; 207121; 207080;
207115; 207114; 207072; 207062; 207126; 207111; 207125; 207116; 207108; 207124;
207112; 207109; 207068; 207097; 207115; 207118; 207110; 207111; 207144; 207116;
207122; 207099; 207090; 207096; 207117; 207116; 207118; 207102; 207125; 207119;
207029; 207115; 207118; 207119; 207113; 207106; 207088; 207115; 207111; 207114;
207118; 207090; 207114; 207114; 207080; 207130; 207124; 207112; 207068; 207094;
]'; %3.5m
[206292; 206225; 206255; 206216; 206252; 206268; 206198; 206249; 206244; 206221;
206256; 206214; 206252; 206237; 206241; 206244; 206203; 206307; 206241; 206254;
206269; 206248; 206275; 206256; 206274; 206212; 206243; 206255; 206219; 206262;
206213; 206229; 206270; 206279; 206257; 206180; 206261; 206302; 206290; 206232;
206261; 206233; 206234; 206272; 206272; 206224; 206253; 206234; 206255; 206261;
206231; 206240; 206229; 206193; 206206; 206224; 206207; 206243; 206190; 206260;
206254; 206248; 206260; 206240; 206243; 206254; 206211; 206261; 206190; 206251;
206157; 206264; 206268; 206246; 206223; 206224; 206252; 206245; 206235; 206212;
206271; 206202; 206250; 206235; 206194; 206265; 206208; 206239; 206193; 206204;
206204; 206222; 206240; 206247; 206167; 206236; 206226; 206248; 206244; 206230;
]'; % 3m
[205664; 205684; 205571; 205595; 205675; 205687; 205522; 205568; 205683; 205683;
205683; 205556; 205692; 205659; 205688; 205695; 205548; 205692; 205684; 205683;
205683; 205677; 205689; 205676; 205577; 205578; 205574; 205549; 205671; 205689;
205576; 205600; 205684; 205694; 205582; 205672; 205702; 205639; 205679; 205571;
205619; 205698; 205675; 205687; 205550; 205551; 205685; 205679; 205708; 205562;
205600; 205678; 205679; 205692; 205579; 205570; 205694; 205597; 205630; 205553;
205578; 205690; 205689; 205661; 205526; 205705; 205664; 205574; 205568; 205570;
205680; 205679; 205576; 205582; 205652; 205662; 205676; 205573; 205581; 205656;
205689; 205678; 205680; 205552; 205658; 205693; 205668; 205586; 205520; 205682;
205678; 205580; 205655; 205685; 205693; 205673; 205676; 205660; 205691; 205713;
]'; %2.5m
% [204090; 204443; 204388; 204421; 204402; 204391; 204477; 204391; 204116; 204071;
% 204429; 204097; 204459; 204067; 204102; 204374; 204424; 204408; 204435; 204338;
% 204412; 204450; 204392; 204465; 204336; 204421; 204135; 204224; 204410; 204247;
% 204140; 204312; 204485; 204412; 204387; 204396; 204320; 204429; 204057; 204400;
% 204413; 204426; 204306; 204181; 204379; 204401; 204395; 204094; 204100; 204096;
% 204095; 204415; 204405; 203605; 204433; 204398; 204062; 204398; 204119; 204067;
% 204437; 204117; 204445; 204348; 204031; 204434; 204501; 204181; 204395; 204415;
% 204254; 204405; 204391; 204305; 204098; 203811; 204443; 204405; 204398; 204377;
% 204127; 204413; 204231; 204453; 204255; 204419; 204429; 204363; 204105; 204465;
% 204143; 204419; 204377; 204449; 204425; 204434; 204427; 204289; 204433; 204405;
% ]'; %1.5m bad data
[204114; 204455; 204390; 204067; 204072; 204364; 204237; 204057; 204303; 204351;
204046; 204392; 204337; 204046; 204384; 204057; 204107; 204337; 204396; 204345;
204053; 203700; 204051; 204419; 204076; 204125; 204080; 204106; 204056; 204353;
203603; 204454; 204044; 204107; 204277; 204423; 204368; 204162; 204359; 204379;
204417; 203991; 204378; 204386; 204044; 204287; 204300; 204059; 204255; 204400;
204344; 204091; 204395; 204209; 204369; 204133; 204409; 204081; 204247; 204352;
204345; 204399; 204362; 204105; 204366; 204113; 204043; 204383; 204368; 204177;
204301; 204396; 204056; 204058; 204319; 204393; 204344; 204371; 204262; 204407;
204333; 204339; 204383; 204398; 204397; 204507; 204335; 204385; 204379; 204377;
204096; 204099; 204094; 204369; 204311; 204229; 204097; 204109; 204154; 204080;
]'; %1.5m hopefully better data (wasnt really better)
[203135; 203369; 203371; 203119; 203381; 203291; 203262; 203299; 203281; 203347;
203353; 203347; 203374; 203327; 203291; 203357; 203371; 203291; 203370; 203412;
203341; 203343; 203349; 203341; 203353; 203381; 203369; 203374; 203293; 203383;
203310; 203349; 203355; 203371; 203349; 203370; 203322; 203374; 203377; 203346;
202626; 203086; 203403; 203236; 203133; 203270; 203363; 203117; 203353; 203122;
203389; 203299; 203380; 203355; 203380; 203383; 203371; 203295; 203356; 203345;
202633; 203271; 203384; 203251; 203303; 203287; 203359; 203348; 203345; 203379;
203367; 203357; 203273; 203404; 203355; 203320; 203349; 203358; 203294; 203387;
203381; 203425; 203353; 203383; 203381; 203369; 203345; 203377; 203339; 203379;
203349; 203373; 203321; 203241; 203261; 203358; 203349; 203351; 203387; 203353;
]'; % 1m
[202149; 202527; 202445; 202491; 202415; 202572; 202640; 201979; 201509; 202581;
202517; 202630; 202022; 202635; 202329; 201673; 202021; 202631; 201469; 201853;
202668; 202043; 202585; 202684; 202675; 201975; 202581; 202283; 202703; 202321;
202001; 202641; 202631; 202004; 202543; 202651; 202021; 201839; 202567; 202617;
202682; 202631; 202605; 201998; 201883; 202665; 202629; 202659; 202501; 201922;
202119; 202668; 202633; 202271; 202295; 202151; 202639; 202017; 202662; 202633;
202017; 202011; 202658; 201913; 202655; 202631; 201627; 202353; 202640; 202689;
202635; 202019; 201855; 201808; 202562; 202000; 202691; 202043; 202709; 202653;
202627; 202638; 202679; 202459; 202606; 202353; 202645; 202654; 202638; 202688;
202638; 202701; 202467; 202590; 202633; 202609; 202005; 202335; 201481; 201921;
]'; %0.5m
];

rising_edge_times = [
[203350; 203250; 203267; 203276; 203247; 203265; 203232; 203245; 203293; 203247;
203274; 203258; 203241; 203251; 203281; 203301; 203297; 203250; 203301; 203306;
203290; 203306; 203313; 203292; 203309; 203305; 203305; 203272; 203296; 203286;
203330; 203253; 203248; 203266; 203243; 203302; 203260; 203237; 203226; 203243;
203250; 203247; 203255; 203245; 203267; 203250; 203276; 203279; 203301; 203289;
203281; 203276; 203302; 203296; 203341; 203297; 203265; 203226; 203263; 203298;
203251; 203244; 203314; 203284; 203244; 203247; 203248; 203250; 203252; 203251;
203255; 203261; 203299; 203307; 203238; 203308; 203293; 203246; 203311; 203347;
203287; 203240; 203261; 203296; 203246; 203250; 203250; 203244; 203271; 203234;
203238; 203257; 203224; 203240; 203272; 203248; 203247; 203251; 203307; 203297;
]'; % 2m
[205997; 205993; 205998; 206017; 205963; 206000; 206022; 205987; 206026; 206045;
206024; 206027; 206071; 206067; 206010; 206044; 206023; 206008; 205986; 205990;
206008; 205967; 206016; 206047; 205970; 206024; 206096; 206054; 205992; 205994;
205974; 206010; 205994; 206075; 206001; 205996; 206038; 206006; 205989; 206013;
205966; 205971; 205988; 205998; 205983; 205992; 206019; 205995; 206006; 206091;
205970; 206029; 206067; 206046; 206016; 205964; 205945; 205995; 205950; 205944;
206055; 206009; 205968; 205990; 206016; 206000; 205986; 205981; 206011; 205990;
206006; 205968; 206024; 205967; 205993; 206024; 205997; 206056; 205966; 205987;
206005; 206014; 205954; 205952; 205963; 205997; 205981; 205997; 205992; 205992;
206003; 206041; 206012; 205973; 206016; 206002; 205958; 205978; 205960; 206002;
]'; % 4m
[205148; 205128; 205121; 205119; 205128; 205127; 205124; 205142; 205112; 205126;
205160; 205129; 205107; 205118; 205120; 205146; 205144; 205115; 205121; 205125;
205110; 205123; 205114; 205109; 205129; 205114; 205121; 205113; 205118; 205172;
205106; 205130; 205111; 205120; 205137; 205107; 205105; 205117; 205118; 205119;
205103; 205134; 205112; 205123; 205117; 205113; 205124; 205168; 205120; 205116;
205124; 205122; 205117; 205110; 205125; 205120; 205141; 205128; 205118; 205134;
205111; 205171; 205118; 205112; 205122; 205118; 205128; 205108; 205118; 205109;
205110; 205120; 205123; 205115; 205112; 205159; 205120; 205123; 205108; 205117;
205113; 205122; 205104; 205122; 205120; 205114; 205104; 205126; 205130; 205102;
205119; 205122; 205119; 205118; 205120; 205119; 205115; 205114; 205119; 205159;
]'; % 3.5m
[204410; 204418; 204406; 204386; 204392; 204401; 204374; 204398; 204385; 204426;
204400; 204375; 204433; 204394; 204404; 204382; 204395; 204422; 204377; 204378;
204374; 204408; 204392; 204354; 204368; 204380; 204364; 204388; 204405; 204427;
204394; 204409; 204381; 204402; 204400; 204392; 204408; 204418; 204385; 204399;
204400; 204357; 204388; 204420; 204403; 204390; 204399; 204406; 204402; 204403;
204396; 204405; 204386; 204349; 204353; 204340; 204379; 204404; 204376; 204392;
204408; 204411; 204374; 204408; 204371; 204400; 204396; 204370; 204408; 204428;
204372; 204405; 204408; 204370; 204376; 204400; 204402; 204373; 204392; 204394;
204399; 204400; 204401; 204393; 204386; 204371; 204397; 204390; 204357; 204385;
204363; 204408; 204348; 204360; 204392; 204396; 204409; 204407; 204366; 204400;
]'; % 3m
[203696; 203695; 203687; 203689; 203684; 203685; 203693; 203685; 203692; 203687;
203685; 203714; 203686; 203723; 203691; 203678; 203690; 203684; 203695; 203684;
203686; 203692; 203684; 203678; 203690; 203681; 203677; 203690; 203683; 203688;
203681; 203674; 203696; 203682; 203696; 203673; 203690; 203702; 203678; 203694;
203680; 203698; 203684; 203680; 203694; 203683; 203694; 203695; 203687; 203686;
203687; 203688; 203680; 203688; 203712; 203664; 203696; 203686; 203691; 203708;
203709; 203693; 203690; 203684; 203685; 203681; 203676; 203689; 203689; 203685;
203681; 203682; 203688; 203684; 203689; 203687; 203686; 203687; 203685; 203686;
203691; 203688; 203691; 203685; 203692; 203684; 203690; 203696; 203680; 203688;
203691; 203690; 203691; 203682; 203712; 203664; 203694; 203685; 203692; 203688;
]'; % 2.5m
% [202569; 202605; 202413; 202573; 202595; 202596; 202184; 202601; 202584; 202551;
% 202584; 202537; 202561; 202378; 202568; 202537; 202395; 202586; 202565; 202480;
% 202605; 202659; 202558; 202613; 202592; 202569; 202567; 202465; 202566; 202397;
% 202128; 202594; 202586; 202572; 202341; 202511; 202583; 202485; 202612; 202593;
% 202561; 202506; 202559; 202515; 202597; 202583; 202589; 202561; 202559; 202588;
% 202565; 202145; 202539; 202393; 202601; 202570; 202187; 202511; 202539; 202581;
% 202595; 202527; 202569; 202579; 202550; 202505; 202557; 202377; 202578; 202267;
% 202463; 202487; 202143; 202564; 202461; 202383; 202600; 202584; 202581; 202563;
% 202369; 202547; 202235; 202576; 202594; 202569; 202386; 202590; 202579; 202575;
% 202479; 202475; 202149; 202383; 202213; 202571; 202389; 202593; 202616; 202131;
% ]';  % 1.5m bad data
[202547; 202579; 202597; 202621; 202596; 202594; 202541; 202587; 202299; 202630;
202565; 202551; 202566; 202589; 202600; 202578; 202589; 202593; 202615; 202617;
202507; 202219; 202603; 202595; 202563; 202116; 202235; 202234; 202475; 202477;
202528; 202179; 202125; 202589; 202585; 202563; 202121; 202476; 202144; 202543;
202584; 202582; 202564; 202103; 202337; 202605; 202193; 202579; 202593; 202357;
202185; 202125; 202129; 202608; 202215; 202125; 202601; 202507; 202116; 202598;
202587; 202219; 202575; 202132; 202597; 202563; 202611; 202574; 202604; 202592;
202589; 202575; 202111; 202366; 202517; 202536; 202109; 202241; 202583; 202615;
202562; 202109; 202594; 202589; 202578; 202571; 202457; 202552; 202156; 202141;
202155; 202492; 202147; 202610; 202533; 202560; 202123; 202587; 202565; 202193;
]'; % 1.5 hopefully better data (wasnt really that better)
[201430; 201433; 201441; 201435; 201430; 201437; 201439; 201424; 201441; 201435;
201432; 201440; 201375; 201435; 201435; 201430; 201438; 201437; 201437; 201387;
201467; 201393; 201480; 201372; 201432; 201431; 201435; 201431; 201443; 201401;
201455; 201430; 201406; 201429; 201417; 201437; 201433; 201437; 201435; 201431;
201427; 201439; 201433; 201383; 201429; 201435; 201433; 201433; 201446; 201396;
201461; 201389; 201423; 201430; 201433; 201437; 201429; 201435; 201431; 201435;
201435; 201381; 201421; 201437; 201435; 201438; 201433; 201434; 201432; 201437;
201427; 201439; 201429; 201453; 201386; 201445; 201372; 201457; 201427; 201443;
201430; 201439; 201431; 201444; 201369; 201437; 201435; 201430; 201437; 201463;
201379; 201471; 201393; 201467; 201377; 201429; 201437; 201433; 201444; 201417;
]'; % 1m
[200727; 200707; 200723; 200723; 200775; 200709; 200719; 200729; 200745; 200744;
200725; 200719; 200746; 200743; 200721; 200723; 200745; 200741; 200719; 200732;
200769; 200715; 200719; 200723; 200770; 200725; 200725; 200739; 200721; 200752;
200717; 200758; 200713; 200723; 200718; 200739; 200741; 200715; 200711; 200714;
200732; 200717; 200721; 200716; 200761; 200722; 200721; 200738; 200743; 200725;
200715; 200717; 200727; 200761; 200729; 200715; 200725; 200731; 200709; 200718;
200708; 200730; 200726; 200717; 200715; 200720; 200712; 200721; 200711; 200722;
200726; 200705; 200721; 200731; 200744; 200725; 200742; 200718; 200719; 200719;
200745; 200747; 200717; 200721; 200737; 200701; 200718; 200723; 200721; 200717;
200731; 200714; 200719; 200719; 200723; 200715; 200771; 200720; 200727; 200716;
]'; % 0.5m
];

dists = [2; 4; 3.5; 3; 2.5; 1.5; 1; 0.5];

y = repmat(dists, 1, length(rising_edge_times));
y = y(:);
x = rising_edge_times(:);

p = polyfit(x, y, 1)

sprintf("Dist = %.20f * time_in_us + %.20f", p(1), p(2))
sprintf("speed of sound in water = %0.20f m/s", p(1)*2*1000000)
sprintf("calculated time delay = %0.20f us", abs(p(2))/p(1))

figure
scatter(x, y); hold on;
plot(x, polyval(p, x));
title("Distance Found Using Trip Time")
ylabel("dist [m]")
xlabel("trip time [us]")